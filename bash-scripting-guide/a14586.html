<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">
    <meta
     name="generator"
     content=
    "HTML Tidy for Linux/x86 (vers 1st July 2002), see www.w3.org">

    <title>Маленький учебник по Sed и Awk</title>
    
    <meta
     name="GENERATOR"
     content="Modular DocBook HTML Stylesheet Version 1.7">
    <link
     rel="HOME"
     title="Advanced Bash-Scripting Guide"
     href="index.html">
    <link
     rel="PREVIOUS"
     title="Дополнительные примеры сценариев"
     href="a14477.html">
    <link
     rel="NEXT"
     title="Awk"
     href="x14802.html">
  </head>

  <body bgcolor="#DDE1C2"><b><a href="http://www.opennet.ru/docs/">Архив документации OpenNet.ru</a> / 
Раздел "<a href="http://www.opennet.ru/docs/124.shtml">Программирование, языки</a>" /
<a href="index.html">Индекс</a>
</b>
<hr noshade size=1>

    <div
     class="NAVHEADER">
      <table
       summary="Header navigation table"
       width="100%"
       border="0"
       cellpadding="0"
       cellspacing="0">
        <tr>
          <th
           colspan="3"
           align="center">Advanced Bash-Scripting Guide: Искусство
          программирования на языке сценариев командной оболочки</th>
        </tr>

        <tr>
          <td
           width="10%"
           align="left"
           valign="bottom"><a
           href="a14477.html"
           accesskey="P">Назад</a></td>

          <td
           width="80%"
           align="center"
           valign="bottom">
          </td>

          <td
           width="10%"
           align="right"
           valign="bottom"><a
           href="x14802.html"
           accesskey="N">Вперед</a></td>
        </tr>
      </table>
      <hr
       align="left"
       width="100%">
    </div>

    <div
     class="APPENDIX">
      <h1><a
       name="SEDAWK"></a>Приложение B. Маленький учебник по Sed и
      Awk</h1>

      <p><a
       name="SEDREF"></a></p>

      <p>В этом приложении содержится очень краткое описание приемов
      работы с утилитами обработки текста <strong
       class="COMMAND">sed</strong> и <strong
       class="COMMAND">awk</strong>. Здесь будут рассмотрены лишь
      несколько базовых команд, которых, в принципе, будет достаточно,
      чтобы научиться понимать простейшие конструкции sed и awk внутри
      сценариев на языке командной оболочки.</p>

      <p><strong
       class="COMMAND">sed</strong>: неинтерактивный редактор текстовых
      файлов</p>

      <p><strong
       class="COMMAND">awk</strong>: язык обработки шаблонов с
      C-подобным синтаксисом</p>

      <p>При всех своих различиях, эти две утилиты обладают похожим
      синтаксисом, они обе умеют работать с <a
       href="c11895.html#REGEXREF">регулярными выражениями</a>, обе,
      по-умолчанию, читают данные с устройства <tt
       class="FILENAME">stdin</tt> и обе выводят результат обработки на
      устройство <tt
       class="FILENAME">stdout</tt>. Обе являются утилитами
      UNIX-систем, и прекрасно могут взаимодействовать между собой.
      Вывод от одной может быть перенаправлен, по конвейеру, на вход
      другой. Их комбинирование придает сценариям, на языке командной
      оболочки, мощь и гибкость языка Perl.</p>

      <div
       class="NOTE">
        <table
         class="NOTE"
         width="100%"
         border="0">
          <tr>
            <td
             width="25"
             align="center"
             valign="top"><img
             src="misc/abs-book/images/note.gif"
             hspace="5"
             alt="Note"></td>

            <td
             align="left"
             valign="top">
              <p>Одно важное отличие состоит в том, что в случае с sed,
              сценарий легко может передавать дополнительные аргументы
              этой утилите, в то время, как в случае с awk (см. <a
               href="x13541.html#COLTOTALER">Пример 33-3</a> и <a
               href="x4788.html#COLTOTALER2">Пример 9-22</a>), это
              более сложная задача .</p>
            </td>
          </tr>
        </table>
      </div>

      <div
       class="SECT1">
        <h1
         class="SECT1"><a
         name="AEN14605"></a>B.1. Sed</h1>

        <p>Sed -- это неинтерактивный строчный редактор. Он принимает
        текст либо с устройства <tt
         class="FILENAME">stdin</tt>, либо из текстового файла,
        выполняет некоторые операции над строками и затем выводит
        результат на устройство <tt
         class="FILENAME">stdout</tt> или в файл. Как правило, в
        сценариях, sed используется в конвейерной обработке данных,
        совместно с другими командами и утилитами.</p>

        <p>Sed определяет, по заданному <span
         class="emphasis"><em
         class="EMPHASIS">адресному пространству</em></span>, над
        какими строками следует выполнить операции. <a
         name="AEN14612"
         href="#FTN.AEN14612"><span
         class="footnote">[1]</span></a> Адресное пространство строк
        задается либо их порядковыми номерами, либо шаблоном. Например,
        команда <tt
         class="REPLACEABLE"><em>3d</em></tt> заставит sed удалить
        третью строку, а команда <tt
         class="REPLACEABLE"><em>/windows/d</em></tt> означает, что все
        строки, содержащие <span
         class="QUOTE">&quot;windows&quot;</span>, должны быть
        удалены.</p>

        <p>Из всего разнообразия операций, мы остановимся на трех,
        используемых наиболее часто. Это <strong
         class="COMMAND">p</strong> -- печать (на <tt
         class="FILENAME">stdout</tt>), <strong
         class="COMMAND">d</strong> -- удаление и <strong
         class="COMMAND">s</strong> -- замена.</p>

        <div
         class="TABLE">
          <a
           name="AEN14623"></a>

          <p><strong>Таблица B-1. Основные операции sed</strong></p>

          <table
           border="1"
           class="CALSTABLE">
            <thead>
              <tr>
                <th
                 align="left"
                 valign="top">Операция</th>

                <th
                 align="left"
                 valign="top">Название</th>

                <th
                 align="left"
                 valign="top">Описание</th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">[диапазон строк]/p</tt></td>

                <td
                 align="left"
                 valign="top">print</td>

                <td
                 align="left"
                 valign="top">Печать [указанного диапазона строк]</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">[диапазон строк]/d</tt></td>

                <td
                 align="left"
                 valign="top">delete</td>

                <td
                 align="left"
                 valign="top">Удалить [указанный диапазон строк]</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">s/pattern1/pattern2/</tt></td>

                <td
                 align="left"
                 valign="top">substitute</td>

                <td
                 align="left"
                 valign="top">Заменить первое встреченное соответствие
                шаблону pattern1, в строке, на pattern2</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">[диапазон
                строк]/s/pattern1/pattern2/</tt></td>

                <td
                 align="left"
                 valign="top">substitute</td>

                <td
                 align="left"
                 valign="top">Заменить первое встреченное соответствие
                шаблону pattern1, на pattern2, в указанном <tt
                 class="REPLACEABLE"><em>диапазоне строк</em></tt></td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">[диапазон
                строк]/y/pattern1/pattern2/</tt></td>

                <td
                 align="left"
                 valign="top">transform</td>

                <td
                 align="left"
                 valign="top">заменить любые символы из шаблона
                pattern1 на соответствующие символы из pattern2, в
                указанном <tt
                 class="REPLACEABLE"><em>диапазоне строк</em></tt>
                (эквивалент команды <strong
                 class="COMMAND">tr</strong>)</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">g</tt></td>

                <td
                 align="left"
                 valign="top">global</td>

                <td
                 align="left"
                 valign="top">Операция выполняется над <span
                 class="emphasis"><em
                 class="EMPHASIS">всеми</em></span> найденными
                соответствиями внутри каждой из заданных строк</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div
         class="NOTE">
          <table
           class="NOTE"
           width="100%"
           border="0">
            <tr>
              <td
               width="25"
               align="center"
               valign="top"><img
               src="misc/abs-book/images/note.gif"
               hspace="5"
               alt="Note"></td>

              <td
               align="left"
               valign="top">
                <p>Без оператора <tt
                 class="OPTION">g</tt> (<span
                 class="emphasis"><em
                 class="EMPHASIS">global</em></span>), операция замены
                будет производиться только для первого найденного
                совпадения, с заданным шаблоном, в каждой строке.</p>
              </td>
            </tr>
          </table>
        </div>

        <p>В отдельных случаях, операции sed необходимо заключать в
        кавычки.</p>
<pre
 class="PROGRAMLISTING">
sed -e &#39;/^$/d&#39; $filename
#  Ключ -e говорит о том, что далее следует строка, которая должна интерпретироваться
#+ как набор инструкций редактирования.
# (При передаче одной инструкции, ключ &quot;-e&quot; является необязательным.)
#  &quot;Строгие&quot; кавычки (&#39;&#39;) предотвращают интерпретацию символов регулярного выражения,
#+ как специальных символов, командным интерпретатором.
#
# Действия производятся над строками, содержащимися в файле $filename.
</pre>
        <br>
        <br>

        <p>В отдельных случаях, команды редактирования не работают в
        одиночных кавычках.</p>
<pre
 class="PROGRAMLISTING">
filename=file1.txt
pattern=BEGIN

  sed &quot;/^$pattern/d&quot; &quot;$filename&quot;  # Результат вполне предсказуем.
# sed &#39;/^$pattern/d&#39; &quot;$filename&quot;    дает иной результат.
#        В данном случае, в &quot;строгих&quot; кавычках (&#39; ... &#39;),
#+      не происходит подстановки значения переменной &quot;$pattern&quot;.
</pre>
        <br>
        <br>

        <div
         class="NOTE">
          <table
           class="NOTE"
           width="100%"
           border="0">
            <tr>
              <td
               width="25"
               align="center"
               valign="top"><img
               src="misc/abs-book/images/note.gif"
               hspace="5"
               alt="Note"></td>

              <td
               align="left"
               valign="top">
                <p>Sed использует ключ <tt
                 class="OPTION">-e</tt> для того, чтобы определить, что
                следующая строка является инструкцией, или набором
                инструкций, редактирования. Если инструкция является
                единственной, то использование этого ключа не является
                обязательным.</p>
              </td>
            </tr>
          </table>
        </div>
<pre
 class="PROGRAMLISTING">
sed -n &#39;/xzy/p&#39; $filename
# Ключ -n заставляет sed вывести только те строки, которые совпадают с указанным шаблоном.
# В противном случае (без ключа -n), будут выведены все строки.
# Здесь, ключ -e не является обязательным, поскольку здесь стоит единственная команда.
</pre>
        <br>
        <br>

        <div
         class="TABLE">
          <a
           name="AEN14681"></a>

          <p><strong>Таблица B-2. Примеры операций в sed</strong></p>

          <table
           border="1"
           class="CALSTABLE">
            <thead>
              <tr>
                <th
                 align="left"
                 valign="top">Операция</th>

                <th
                 align="left"
                 valign="top">Описание</th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">8d</tt></td>

                <td
                 align="left"
                 valign="top">Удалить 8-ю строку.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">/^$/d</tt></td>

                <td
                 align="left"
                 valign="top">Удалить все пустые строки.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">1,/^$/d</tt></td>

                <td
                 align="left"
                 valign="top">Удалить все строки до первой пустой
                строки, включительно.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">/Jones/p</tt></td>

                <td
                 align="left"
                 valign="top">Вывести строки, содержащие <span
                 class="QUOTE">&quot;Jones&quot;</span> (с ключом <span
                 class="TOKEN">-n</span>).</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">s/Windows/Linux/</tt></td>

                <td
                 align="left"
                 valign="top">В каждой строке, заменить первое
                встретившееся слово <span
                 class="QUOTE">&quot;Windows&quot;</span> на слово
                <span
                 class="QUOTE">&quot;Linux&quot;</span>.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">s/BSOD/stability/g</tt></td>

                <td
                 align="left"
                 valign="top">В каждой строке, заменить все
                встретившиеся слова <span
                 class="QUOTE">&quot;BSOD&quot;</span> на <span
                 class="QUOTE">&quot;stability&quot;</span>.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">s/ *$//</tt></td>

                <td
                 align="left"
                 valign="top">Удалить все пробелы в конце каждой
                строки.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">s/00*/0/g</tt></td>

                <td
                 align="left"
                 valign="top">Заменить все последовательности ведущих
                нулей одним символом &quot;0&quot;.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">/GUI/d</tt></td>

                <td
                 align="left"
                 valign="top">Удалить все строки, содержащие <span
                 class="QUOTE">&quot;GUI&quot;</span>.</td>
              </tr>

              <tr>
                <td
                 align="left"
                 valign="top"><tt
                 class="OPTION">s/GUI//g</tt></td>

                <td
                 align="left"
                 valign="top">Удалить все найденные <span
                 class="QUOTE">&quot;GUI&quot;</span>, оставляя
                остальную часть строки без изменений.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <p>Замена строки пустой строкой, эквивалентна удалению части
        строки, совпадающей с шаблоном. Остальная часть строки остается
        без изменений. Например, <tt
         class="USERINPUT"><strong>s/GUI//</strong></tt>, изменит
        следующую строку</p>
<pre
 class="SCREEN">
<tt
 class=
"USERINPUT"><strong>The most important parts of any application are its GUI and sound effects</strong></tt>
</pre>
        на 
<pre
 class="SCREEN">
<tt
 class=
"COMPUTEROUTPUT">The most important parts of any application are its  and sound effects</tt>
</pre>
        <br>
        <br>

        <p>Символ обратного слэша представляет символ перевода строки,
        как символ замены. В этом случае, замещающее выражение
        продолжается на следующей строке.</p>
<pre
 class="PROGRAMLISTING">
s/^  */\
/g
</pre>
        Эта инструкция заменит начальные пробелы в строке на символ
        перевода строки. Ожидаемый результат -- замена отступов в
        начале параграфа пустыми строками.<br>
        <br>

        <p>Указание диапазона строк, предшествующее одной, или более,
        инструкции может потребовать заключения инструкций в фигурные
        скобки, с соответствующими символами перевода строки.</p>
<pre
 class="PROGRAMLISTING">
/[0-9A-Za-z]/,/^$/{
/^$/d
}
</pre>
        В этом случае будут удалены только первые из нескольких, идущих
        подряд, пустых строк. Это может использоваться для установки
        однострочных интервалов в файле, оставляя, при этом, пустые
        строки между параграфами.<br>
        <br>

        <div
         class="TIP">
          <table
           class="TIP"
           width="100%"
           border="0">
            <tr>
              <td
               width="25"
               align="center"
               valign="top"><img
               src="misc/abs-book/images/tip.gif"
               hspace="5"
               alt="Tip"></td>

              <td
               align="left"
               valign="top">
                <p>Быстрый способ установки двойных межстрочных
                интервалов в текстовых файлах -- <tt
                 class="USERINPUT"><strong>sed G
                filename</strong></tt>.</p>
              </td>
            </tr>
          </table>
        </div>

        <p>Примеры использования sed в сценариях командной оболочки, вы
        найдете в:</p>

        <ol
         type="1">
          <li>
            <p><a
             href="x13541.html#EX3">Пример 33-1</a></p>
          </li>

          <li>
            <p><a
             href="x13541.html#EX4">Пример 33-2</a></p>
          </li>

          <li>
            <p><a
             href="x6646.html#EX57">Пример 12-2</a></p>
          </li>

          <li>
            <p><a
             href="a14477.html#RN">Пример A-3</a></p>
          </li>

          <li>
            <p><a
             href="x7050.html#GRP">Пример 12-12</a></p>
          </li>

          <li>
            <p><a
             href="x7050.html#COL">Пример 12-20</a></p>
          </li>

          <li>
            <p><a
             href="a14477.html#BEHEAD">Пример A-13</a></p>
          </li>

          <li>
            <p><a
             href="a14477.html#TREE">Пример A-19</a></p>
          </li>

          <li>
            <p><a
             href="x7794.html#STRIPC">Пример 12-24</a></p>
          </li>

          <li>
            <p><a
             href="c4875.html#FINDSTRING">Пример 10-9</a></p>
          </li>

          <li>
            <p><a
             href="x9199.html#BASE">Пример 12-33</a></p>
          </li>

          <li>
            <p><a
             href="a14477.html#MAILFORMAT">Пример A-2</a></p>
          </li>

          <li>
            <p><a
             href="x7050.html#RND">Пример 12-10</a></p>
          </li>

          <li>
            <p><a
             href="x7050.html#WF">Пример 12-8</a></p>
          </li>

          <li>
            <p><a
             href="a14477.html#LIFESLOW">Пример A-11</a></p>
          </li>

          <li>
            <p><a
             href="c11785.html#SELFDOCUMENT">Пример 17-11</a></p>
          </li>
        </ol>
        <br>
        <br>

        <p>Ссылки на дополнительные сведения о sed, вы найдете в
        разделе <a
         href="b14059.html"><em>Литература</em></a>.</p>
      </div>
    </div>

    <h3
     class="FOOTNOTES">Примечания</h3>

    <table
     border="0"
     class="FOOTNOTES"
     width="100%">
      <tr>
        <td
         align="left"
         valign="top"
         width="5%"><a
         name="FTN.AEN14612"
         href="a14586.html#AEN14612"><span
         class="footnote">[1]</span></a></td>

        <td
         align="left"
         valign="top"
         width="95%">
          <p>Если адресное пространство не указано, то, по-умолчанию, к
          обработке принимаются <span
           class="emphasis"><em
           class="EMPHASIS">все</em></span> строки.</p>
        </td>
      </tr>
    </table>

    <div
     class="NAVFOOTER">
      <hr
       align="left"
       width="100%">

      <table
       summary="Footer navigation table"
       width="100%"
       border="0"
       cellpadding="0"
       cellspacing="0">
        <tr>
          <td
           width="33%"
           align="left"
           valign="top"><a
           href="a14477.html"
           accesskey="P">Назад</a></td>

          <td
           width="34%"
           align="center"
           valign="top"><a
           href="index.html"
           accesskey="H">К началу</a></td>

          <td
           width="33%"
           align="right"
           valign="top"><a
           href="x14802.html"
           accesskey="N">Вперед</a></td>
        </tr>

        <tr>
          <td
           width="33%"
           align="left"
           valign="top">Дополнительные примеры сценариев</td>

          <td
           width="34%"
           align="center"
           valign="top"> </td>

          <td
           width="33%"
           align="right"
           valign="top">Awk</td>
        </tr>
      </table>
    </div>
  <hr noshade size=1>
<b><a href="http://www.opennet.ru/docs/">Архив документации на OpenNet.ru</a>
</body>
</html>

