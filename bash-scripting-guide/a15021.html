<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">
    <meta
     name="generator"
     content=
    "HTML Tidy for Linux/x86 (vers 1st July 2002), see www.w3.org">

    <title>Локализация</title>
    
    <meta
     name="GENERATOR"
     content="Modular DocBook HTML Stylesheet Version 1.7">
    <link
     rel="HOME"
     title="Advanced Bash-Scripting Guide"
     href="index.html">
    <link
     rel="PREVIOUS"
     title=
    "Подробное введение в операции ввода-вывода и перенаправление ввода-вывода"
     href="a14967.html">
    <link
     rel="NEXT"
     title="История команд"
     href="a15070.html">
  </head>

  <body bgcolor="#DDE1C2"><b><a href="http://www.opennet.ru/docs/">Архив документации OpenNet.ru</a> / 
Раздел "<a href="http://www.opennet.ru/docs/124.shtml">Программирование, языки</a>" /
<a href="index.html">Индекс</a>
</b>
<hr noshade size=1>

    <div
     class="NAVHEADER">
      <table
       summary="Header navigation table"
       width="100%"
       border="0"
       cellpadding="0"
       cellspacing="0">
        <tr>
          <th
           colspan="3"
           align="center">Advanced Bash-Scripting Guide: Искусство
          программирования на языке сценариев командной оболочки</th>
        </tr>

        <tr>
          <td
           width="10%"
           align="left"
           valign="bottom"><a
           href="a14967.html"
           accesskey="P">Назад</a></td>

          <td
           width="80%"
           align="center"
           valign="bottom">
          </td>

          <td
           width="10%"
           align="right"
           valign="bottom"><a
           href="a15070.html"
           accesskey="N">Вперед</a></td>
        </tr>
      </table>
      <hr
       align="left"
       width="100%">
    </div>

    <div
     class="APPENDIX">
      <h1><a
       name="LOCALIZATION"></a>Приложение E. Локализация</h1>

      <p>Возможность локализации сценариев Bash нигде в документации не
      описана.</p>

      <p>Локализованные сценарии выводят текст на том языке, который
      используется системой, в соответствии с настройками. Пользователь
      Linux, живущий в Берлине (Германия), будет видеть сообщения на
      немецком языке, в то время как другой пользователь, проживающий в
      Берлине штата Мэриленд (США) -- на английском.</p>

      <p>Для создания локализованых сценариев можно использовать
      следующий шаблон, предусматривающий вывод всех сообщений на языке
      пользователя (сообщения об ошибках, приглашения к вводу и
      т.п.).</p>
<pre
 class="PROGRAMLISTING">
#!/bin/bash
# localized.sh

E_CDERROR=65

error()
{
  printf &quot;$@&quot; &gt;&amp;2
  exit $E_CDERROR
}

cd $var || error $&quot;Can&#39;t cd to %s.&quot; &quot;$var&quot;
read -p $&quot;Enter the value: &quot; var
# ...
</pre>
      <br>
      <br>
<pre
 class="SCREEN">
<tt
 class="PROMPT">bash$</tt> <tt
 class="USERINPUT"><strong>bash -D localized.sh</strong></tt>
<tt
 class="COMPUTEROUTPUT">&quot;Can&#39;t cd to %s.&quot;
&quot;Enter the value: &quot;</tt>
</pre>
      Это список всех текстовых сообщений, которые подлежат
      локализации. (Ключ <tt
       class="OPTION">-D</tt> выводит список строк в двойных кавычках,
      которым предшествует символ <span
       class="TOKEN">$</span>, без запуска сценария на исполнение.)<br>
      <br>
<pre
 class="SCREEN">
<tt
 class="PROMPT">bash$</tt> <tt
 class=
"USERINPUT"><strong>bash --dump-po-strings localized.sh</strong></tt>
<tt
 class="COMPUTEROUTPUT">#: a:6
 msgid &quot;Can&#39;t cd to %s.&quot;
 msgstr &quot;&quot;
 #: a:7
 msgid &quot;Enter the value: &quot;
 msgstr &quot;&quot;</tt>
</pre>
      Ключ <tt
       class="OPTION">--dump-po-strings</tt> в Bash напоминает ключ <tt
       class="OPTION">-D</tt>, но выводит строки в формате <span
       class="QUOTE">&quot;po&quot;</span>, с помощью утилиты <a
       href="x7050.html#GETTEXTREF">gettext</a>. <br>
      <br>

      <p>Теперь построим файл <tt
       class="FILENAME">language.po</tt>, для каждого языка, на которые
      предполагается перевести сообщения сценария. Например:</p>

      <p>Файл ru.po сделан переводчиком, в оригинальном документе
      локализация выполнена на примере французского языка</p>

      <p>ru.po:</p>
<pre
 class="PROGRAMLISTING">
#: a:6
msgid &quot;Can&#39;t cd to %s.&quot;
msgstr &quot;Невозможно перейти в каталог %s.&quot;
#: a:7
msgid &quot;Enter the value: &quot;
msgstr &quot;Введите число: &quot;
</pre>
      <br>
      <br>

      <p>Затем запустите <strong
       class="COMMAND">msgfmt</strong>.</p>

      <p><tt
       class="USERINPUT"><strong>msgfmt -o localized.sh.mo
      ru.po</strong></tt></p>

      <p>Перепишите получившийся файл <tt
       class="FILENAME">localized.sh.mo</tt> в каталог <tt
       class="FILENAME">/usr/share/locale/ru/LC_MESSAGES</tt> и
      добавьте в начало сценария строки:</p>
<pre
 class="PROGRAMLISTING">
TEXTDOMAINDIR=/usr/share/locale
TEXTDOMAIN=localized.sh
</pre>
      <br>
      <br>

      <p>Если система корректно настроена на русскую локаль, то
      пользователь, запустивший сценарий, будет видеть сообщения на
      русском языке.</p>

      <div
       class="NOTE">
        <table
         class="NOTE"
         width="100%"
         border="0">
          <tr>
            <td
             width="25"
             align="center"
             valign="top"><img
             src="misc/abs-book/images/note.gif"
             hspace="5"
             alt="Note"></td>

            <td
             align="left"
             valign="top">
              <p>В старых версиях Bash или в других командных
              оболочках, потребуется воспользоваться услугами утилиты
              <a
               href="x7050.html#GETTEXTREF">gettext</a>, с ключом <tt
               class="OPTION">-s</tt>. В этом случае наш сценарий будет
              выглядеть так:</p>

              <p><a
               name="GETTEXTEXAMPLE"></a></p>
<pre
 class="PROGRAMLISTING">
#!/bin/bash
# localized.sh

E_CDERROR=65

error() {
  local format=$1
  shift
  printf &quot;$(gettext -s &quot;$format&quot;)&quot; &quot;$@&quot; &gt;&amp;2
  exit $E_CDERROR
}
cd $var || error &quot;Can&#39;t cd to %s.&quot; &quot;$var&quot;
read -p &quot;$(gettext -s &quot;Enter the value: &quot;)&quot; var
# ...
</pre>
              <br>
              <br>
            </td>
          </tr>
        </table>
      </div>

      <p>А переменные <tt
       class="VARNAME">TEXTDOMAIN</tt> и <tt
       class="VARNAME">TEXTDOMAINDIR</tt>, необходимо будет
      экспортировать в окружение.</p>

      <p>---</p>

      <p>Автор этого приложения: Stephane Chazelas.</p>
    </div>

    <div
     class="NAVFOOTER">
      <hr
       align="left"
       width="100%">

      <table
       summary="Footer navigation table"
       width="100%"
       border="0"
       cellpadding="0"
       cellspacing="0">
        <tr>
          <td
           width="33%"
           align="left"
           valign="top"><a
           href="a14967.html"
           accesskey="P">Назад</a></td>

          <td
           width="34%"
           align="center"
           valign="top"><a
           href="index.html"
           accesskey="H">К началу</a></td>

          <td
           width="33%"
           align="right"
           valign="top"><a
           href="a15070.html"
           accesskey="N">Вперед</a></td>
        </tr>

        <tr>
          <td
           width="33%"
           align="left"
           valign="top">Подробное введение в операции ввода-вывода и
          перенаправление ввода-вывода</td>

          <td
           width="34%"
           align="center"
           valign="top"> </td>

          <td
           width="33%"
           align="right"
           valign="top">История команд</td>
        </tr>
      </table>
    </div>
  <hr noshade size=1>
<b><a href="http://www.opennet.ru/docs/">Архив документации на OpenNet.ru</a>
</body>
</html>

